{"version":3,"sources":["worker.browser/worker.js"],"names":[],"mappings":"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","file":"worker.browser/worker.js","sourcesContent":["import EventEmitter from 'eventemitter3';\nimport slaveCode from './slave-code';\n\nimport { getConfig } from '../config';\n\n\nif (typeof window.Worker !== 'object' && typeof window.Worker !== 'function') {\n  throw new Error('Browser does not support web workers!');\n}\n\nvar blob;\ntry {\n    blob = new Blob([slaveCode], {type: 'application/javascript'});\n} catch (e) { // Backwards-compatibility\n    var BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder;\n    blob = new BlobBuilder();\n    blob.append(slaveCode);\n    blob = blob.getBlob();\n}\n\nfunction prependScriptUrl(scriptUrl) {\n  const prefix = getConfig().basepath.web;\n  return prefix ? prefix + '/' + scriptUrl : scriptUrl;\n}\n\nfunction convertToArray(input) {\n  let outputArray = [];\n  let index = 0;\n\n  while (typeof input[index] !== 'undefined') {\n    outputArray.push(input[index]);\n    index++;\n  }\n\n  return outputArray;\n}\n\nfunction logError(error) {\n  if (error.stack) {\n    console.error(error.stack);                                             // eslint-disable-line no-console\n  } else if (error.message && error.filename && error.lineno) {\n    const fileName = error.filename.match(/^data:text\\/javascript/) && error.filename.length > 50\n                   ? error.filename.substr(0, 50) + '...'\n                   : error.filename;\n    console.error(`${error.message} @${fileName}:${error.lineno}`);   // eslint-disable-line no-console\n  } else {\n    console.error(error);                                                   // eslint-disable-line no-console\n  }\n}\n\n\nexport default class Worker extends EventEmitter {\n  constructor(initialScript = null, importScripts = []) {\n    super();\n\n    this.initWorker();\n    this.worker.addEventListener('message', this.handleMessage.bind(this));\n    this.worker.addEventListener('error', this.handleError.bind(this));\n\n    if (initialScript) {\n      this.run(initialScript, importScripts);\n    }\n  }\n\n  initWorker() {\n    try {\n      this.worker = new window.Worker(URL.createObjectURL(blob));\n    } catch (error) {\n      const slaveScriptUrl = getConfig().fallback.slaveScriptUrl;\n      if (slaveScriptUrl) {\n        // try using the slave script file instead of the data URI\n        this.worker = new window.Worker(slaveScriptUrl);\n      } else {\n        // re-throw\n        throw error;\n      }\n    }\n  }\n\n  run(toRun, importScripts = []) {\n    if (typeof toRun === 'function') {\n      this.runMethod(toRun, importScripts);\n    } else {\n      this.runScripts(toRun, importScripts);\n    }\n    return this;\n  }\n\n  require(method, name) {\n    const methodStr = method.toString();\n    const args = methodStr.substring(methodStr.indexOf('(') + 1, methodStr.indexOf(')')).split(',');\n    const body = methodStr.substring(methodStr.indexOf('{') + 1, methodStr.lastIndexOf('}'));\n\n    this.worker.postMessage({\n      require: true,\n      method: { args, body },\n      name: name || method.name\n    });\n  }\n\n  runMethod(method, importScripts) {\n    const methodStr = method.toString();\n    const args = methodStr.substring(methodStr.indexOf('(') + 1, methodStr.indexOf(')')).split(',');\n    const body = methodStr.substring(methodStr.indexOf('{') + 1, methodStr.lastIndexOf('}'));\n\n    this.worker.postMessage({\n      initByMethod : true,\n      method       : { args, body },\n      scripts      : importScripts.map(prependScriptUrl)\n    });\n  }\n\n  runScripts(script, importScripts) {\n    if (!script) { throw new Error('Must pass a function or a script URL to run().'); }\n\n    // attention: array for browser, single script for node\n    this.worker.postMessage({\n      initByScripts : true,\n      scripts       : importScripts.concat([ script ]).map(prependScriptUrl)\n    });\n  }\n\n  send(param, transferables = []) {\n    this.worker.postMessage({\n      doRun : true,\n      param\n    }, transferables);\n    return this;\n  }\n\n  kill() {\n    this.worker.terminate();\n    this.emit('exit');\n    return this;\n  }\n\n  promise() {\n    return new Promise((resolve, reject) => {\n      this\n        .once('message', resolve)\n        .once('error', reject);\n    });\n  }\n\n  handleMessage(event) {\n    if (event.data.error) {\n      this.handleError(event.data.error);\n    } else if (event.data.progress) {\n      this.handleProgress(event.data.progress);\n    } else {\n      const responseArgs = convertToArray(event.data.response);\n      this.emit('message', ...responseArgs);\n    }\n  }\n\n  handleProgress(progress) {\n    this.emit('progress', progress);\n  }\n\n  handleError(error) {\n    if (!this.listeners('error', true)) {\n      logError(error);\n    }\n\n    if (error.preventDefault) {\n      error.preventDefault();\n    }\n\n    this.emit('error', error);\n  }\n}\n"],"sourceRoot":"/source/"}